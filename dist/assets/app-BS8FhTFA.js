let d=new WebSocket("ws://localhost:8080");d.onopen=function(){console.log("Подключено к WebSocket серверу")};d.onmessage=function(t){console.log("Получено сообщение:",t.data);let n=document.getElementById("messages");n&&(n.innerHTML+=`<p>${t.data}</p>`)};d.onerror=function(t){console.error("Ошибка WebSocket:",t)};d.onclose=function(){console.log("Соединение закрыто")};window.createItem=async function(){let t=document.getElementById("product-name").value.trim(),n=document.getElementById("product-price").value.trim(),o=document.getElementById("product-stock").value.trim();if(!t||!n||!o){alert("Заполните все поля!");return}try{let e=await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,price:n,stock:o})});if(!e.ok)throw new Error(`Ошибка: ${e.statusText}`);let a=await e.json();d.send(`Создан товар: ${a.name} (ID: ${a.id})`),document.getElementById("product-name").value="",document.getElementById("product-price").value="",document.getElementById("product-stock").value="",loadItems()}catch(e){console.error("Ошибка при создании товара:",e)}};window.loadItems=async function(){let n=await(await fetch("/api/products")).json(),o=document.getElementById("product-list");n.length===0?o.innerHTML="<li>Нет товаров</li>":o.innerHTML=n.map(e=>`
            <li>
                ${e.name} - ${e.price}₽ - ${e.stock} шт.
                <button onclick="editItem(${e.id}, '${e.name}', ${e.price}, ${e.stock})">✏️</button>
                <button onclick="deleteItem(${e.id})">❌</button>
            </li>
        `).join("")};window.updateItem=async function(t){let n=document.getElementById("update-name").value.trim(),o=document.getElementById("update-price").value.trim(),e=document.getElementById("update-stock").value.trim();if(!n||!o||!e){alert("Заполните все поля!");return}try{await fetch(`/api/products/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,price:o,stock:e})}),d.send(`Товар (ID: ${t}) обновлен`),loadItems(),clearUpdateForm(),hideUpdateForm()}catch(a){console.error("Ошибка при обновлении товара:",a)}};window.deleteItem=async function(t){await fetch(`/api/products/${t}`,{method:"DELETE"}),d.send(`Товар (ID: ${t}) удален`),loadItems()};window.editItem=function(t,n,o,e){document.getElementById("update-name").value=n,document.getElementById("update-price").value=o,document.getElementById("update-stock").value=e,document.getElementById("update-button").onclick=function(){updateItem(t)},showUpdateForm()};window.showUpdateForm=function(){document.getElementById("update-form").style.display="block"};window.hideUpdateForm=function(){document.getElementById("update-form").style.display="none"};window.clearUpdateForm=function(){document.getElementById("update-name").value="",document.getElementById("update-price").value="",document.getElementById("update-stock").value="",document.getElementById("update-button").onclick=null};window.onload=function(){loadItems()};
